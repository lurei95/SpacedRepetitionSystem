@page "/Cards"

@using SpacedRepetitionSystem.Components.ViewModels;
@using SpacedRepetitionSystem.Entities.Entities.SmartCards;
@using SpacedRepetitionSystem.Components.ViewModels.SmartCards;

@inherits SearchPageBase<SmartCard, SmartCardSearchViewModel>

<ViewModelArea ViewModel="@ViewModel">
  <div class="card flex-grow-0 searchCard">
    <div class="card-header">
      Search Cards
    </div>
    <div class="card-body scrollable">

      @if (ViewModel.IsSearching)
      {
        <div class="d-flex justify-content-center waitSpinnerContainer">
          <div class="spinner-border waitSpinner" role="status">
            <span class="sr-only">Loading...</span>
          </div>
        </div>
      }
      else
      {
        <table id="dtBasicExample" class="table table-striped table-bordered" cellspacing="0" width="100%">
          <thead>
            <tr>
              <th class="th-sm">
                ID
              </th>
              <th class="th-sm">
                Deck
              </th>
              <th class="th-sm">
                Field 1
              </th>
              <th class="th-sm">
                Field 2
              </th>
              <th class="th-sm">
                Field 3
              </th>
            </tr>
          </thead>
          <tbody>
            @foreach (var item in ViewModel.SearchResults)
            {
              <tr>
                <td><a href="/Cards/@item.SmartCardId">@item.SmartCardId</a></td>
                <td><a href="/Decks/@item.PracticeSetId">@item.PracticeSet?.Title</a></td>
                <td>@item.Fields[0].FieldName</td>
                <td>@item.Fields[1].FieldName</td>
                <td>@item.Fields.Count > 2 ? item.Fields[2].FieldName : null</td>
              </tr>
            }
          </tbody>
        </table>
      }
    </div>
  </div>
</ViewModelArea>

<style>
  .waitSpinnerContainer {
    height: calc(100vh - 200px);
    align-items: center;
  }

  .waitSpinner {
    width: 7rem;
    height: 7rem;
  }
</style>

@code
{
  protected override async Task OnInitializedAsync()
  {
    await base.OnInitializedAsync();
    await ViewModel.Search();
  }
}
