@page "/Cards/{Id:long}"
@page "/Cards/New"
@page "/Decks/{DeckId:long}/Cards/New"
@page "/Decks/{DeckId:long}/Cards/{Id:long}"

@using SpacedRepetitionSystem.Entities.Entities.Cards;
@using SpacedRepetitionSystem.Components.ViewModels.Cards;
@using SpacedRepetitionSystem.Components.Interaction;
@using SpacedRepetitionSystem.Components.Edits;
@using SpacedRepetitionSystem.Components.ViewModels;
@using SpacedRepetitionSystem.Components.Containers;

@inherits EditPageBase<SpacedRepetitionSystem.Entities.Entities.Cards.Card, CardEditViewModel>

<ViewModelArea ViewModel="ViewModel">
  <TabCard Title="@ViewModel?.Entity?.GetDisplayName()" IsLoading="@IsLoading">
    <CardTabs>
      <CardTab Title="Main">
        <div class="tab-content" id="myTabContent">
          <div class="tab-pane fade show active" id="main" role="tabpanel" aria-labelledby="home-tab">
            <h5 class="card-title">Main Properties</h5>
            <DropDownEdit Caption="Template" Property="ViewModel.CardTemplateTitleProperty" SelectableValues="ViewModel.AvailableCardTemplates"></DropDownEdit>

            <h5 class="card-title">Fields</h5>
            @foreach (CardField field in ViewModel.Fields)
            {
              <TextEdit Caption="@field.FieldName" @bind-Value="field.Value"></TextEdit>
            }
            <h5 class="card-title">Tags</h5>
            <TagEdit Tags="ViewModel.Tags"></TagEdit>
          </div>
        </div>
      </CardTab>
    </CardTabs>
    <HeaderButtons>
      <Button Command="@ViewModel?.DeleteCommand" IsIconButton="true" TextColor="black" Style="margin-top: 1px; margin-right: 10px"></Button>
      <Button Command="@ViewModel?.CloseCommand" IsIconButton="true" TextColor="#e74c3c"></Button>
    </HeaderButtons>
    <ChildContent>
      <div class="d-flex justify-content-end">
        <Button Class="btn-primary btn-lg" Command="ViewModel.SaveChangesCommand"></Button>
      </div>
    </ChildContent>
  </TabCard>
</ViewModelArea>

@code
{
  /// <summary>
  /// Id of the deck
  /// </summary>
  [Parameter]
  public long? DeckId { get; set; }

  ///<inheritdoc/>
  protected override void OnParametersSet()
  {
    base.OnParametersSet();
    ViewModel.DeckId = DeckId;
  }
}